---@diagnostic disable: undefined-global
-- title:   game title
-- author:  game developer, email, etc.
-- desc:    short description
-- site:    website link
-- license: MIT License (change this to your license of choice)
-- version: 0.1
-- script:  lua

-- Global variables --

local SFX = {
	DROP = 0,
	MOVE = 1,
	ROTATE = 2,
	CLEAR = 3,
	OVERFLOW = 4,
	INVALID = 5,
}

local TRACK = {
	FLORA = 0,
	FEVER = 1,
}

-- Global variables end --

-- Audio manager --

local Audio = {
	bgm = nil,
	reserved = {
		sfx = 3,
		bgm = { 0, 1, 2 },
	},
}

function Audio.playBGM(track, loop)
	if Audio.bgm == track then
		return
	end
	music(track, 0, 0, loop ~= false)
	Audio.bgm = track
end

function Audio.stopBGM()
	music(-1)
	Audio.bgm = nil
end

function Audio.play(id, vol, spd)
	sfx(id, nil, -1, Audio.reserved.sfx, vol or 15, spd or 0, false)
end

-- Audio manager end --

-- Pill manager --

local PILLS = {
	RED = 256,
	YELLOW = 258,
	BLUE = 260,
}

local VIRUSES = {
	YELLOW_1 = 274,
	YELLOW_2 = 275,
	YELLOW_3 = 290,
	YELLOW_4 = 291,
	BLUE_1 = 276,
	BLUE_2 = 277,
	BLUE_3 = 292,
	BLUE_4 = 293,
	RED_1 = 272,
	RED_2 = 273,
	RED_3 = 288,
	RED_4 = 289,
}

-- Pill manager end --

-- Game manager --

local SCENES = {
	TITLE = 0,
	GAME = 1,
}

local Game = {
	scene = SCENES.GAME,
	grid,
}

-- Game manager end --

-- Grid manager --

local BORDER = {
	TOPLEFT = 32,
	TOP = 33,
	TOPRIGHT = 34,
	LEFT = 48,
	CENTER = 49,
	RIGHT = 50,
	BOTTOMLEFT = 64,
	BOTTOM = 65,
	BOTTOMRIGHT = 66,
}

local Grid = {
	cell_size = 8,
	h = 16,
	w = 10,
}

function Grid.draw()
	for y = 0, Grid.h - 1 do
		local cy = y * Grid.cell_size
		for x = 0, Grid.w - 1 do
			local cx = x * Grid.cell_size

			if y == 0 then
				if x == 0 then
					spr(BORDER.TOPLEFT, cx, cy)
				elseif x == Grid.w - 1 then
					spr(BORDER.TOPRIGHT, cx, cy)
				else
					spr(BORDER.TOP, cx, cy)
				end
			elseif y == Grid.h - 1 then
				if x == 0 then
					spr(BORDER.BOTTOMLEFT, cx, cy)
				elseif x == Grid.w - 1 then
					spr(BORDER.BOTTOMRIGHT, cx, cy)
				else
					spr(BORDER.BOTTOM, cx, cy)
				end
			else
				if x == 0 then
					spr(BORDER.LEFT, cx, cy)
				elseif x == Grid.w - 1 then
					spr(BORDER.RIGHT, cx, cy)
				else
					spr(BORDER.CENTER, cx, cy)
				end
			end
		end
	end
end

-- Grid manager end --

t = 0
x = 96
y = 24

function TIC()
	Audio.playBGM(TRACK.FLORA)

	if btn(0) then
		y = y - 1
	end
	if btn(1) then
		y = y + 1
	end
	if btn(2) then
		x = x - 1
	end
	if btn(3) then
		x = x + 1
	end

	cls(13)
	Grid.draw()
	t = t + 1
end

-- <TILES>
-- 001:eccccccccc888888caaaaaaaca888888cacccccccacc0ccccacc0ccccacc0ccc
-- 002:ccccceee8888cceeaaaa0cee888a0ceeccca0ccc0cca0c0c0cca0c0c0cca0c0c
-- 003:eccccccccc888888caaaaaaaca888888cacccccccacccccccacc0ccccacc0ccc
-- 004:ccccceee8888cceeaaaa0cee888a0ceeccca0cccccca0c0c0cca0c0c0cca0c0c
-- 017:cacccccccaaaaaaacaaacaaacaaaaccccaaaaaaac8888888cc000cccecccccec
-- 018:ccca00ccaaaa0ccecaaa0ceeaaaa0ceeaaaa0cee8888ccee000cceeecccceeee
-- 019:cacccccccaaaaaaacaaacaaacaaaaccccaaaaaaac8888888cc000cccecccccec
-- 020:ccca00ccaaaa0ccecaaa0ceeaaaa0ceeaaaa0cee8888ccee000cceeecccceeee
-- 032:0000000000bbbbbb0bbbbbbb0bbb00000bb0f00f0bb000000bb000000bb0f00f
-- 033:00000000bbbbbbbbbbbbbbbb0000000000f00f00000000000000000000f00f00
-- 034:00000000bbbbbb00bbbbbbb00000bbb0f00f0bb000000bb000000bb0f00f0bb0
-- 048:0bb000000bb000000bb0f00f0bb000000bb000000bb0f00f0bb000000bb00000
-- 049:000000000000000000f00f00000000000000000000f00f000000000000000000
-- 050:00000bb000000bb0f00f0bb000000bb000000bb0f00f0bb000000bb000000bb0
-- 064:0bb0f00f0bb000000bb000000bb0f00f0bbb00000bbbbbbb00bbbbbb00000000
-- 065:00f00f00000000000000000000f00f0000000000bbbbbbbbbbbbbbbb00000000
-- 066:f00f0bb000000bb000000bb0f00f0bb00000bbb0bbbbbbb0bbbbbb0000000000
-- </TILES>

-- <SPRITES>
-- 000:0000000000222222022222220222222202222222022222220022222200000000
-- 001:0000000022222200222222202222222022222220222222202222220000000000
-- 002:0000000000444444044444440444444404444444044444440044444400000000
-- 003:0000000044444400444444404444444044444440444444404444440000000000
-- 004:0000000000999999099999990999999909999999099999990099999900000000
-- 005:0000000099999900999999909999999099999990999999909999990000000000
-- 016:33333333322332233222222332f22f2332222223322ff2233322223303333330
-- 017:33333333322332233222222332f22f2332222223322ff223332ff23303333330
-- 018:440000444444444404444440044ff44004444440044444400044440000044000
-- 019:440000444444444404444440044fff4004444440044444400044440000044000
-- 020:99000099099999900999999009f99f9009999990900000090900009009999990
-- 021:9900009909999990099999900999999009f99f90999999990900009009999990
-- 032:33333333322332233222222332f22f2332f22f23322ff223332ff23303333330
-- 033:3333333332233223322222233222222332f22f23322ff223332ff23303333330
-- 034:44000044444444440444444004fff44004444440044444400044440000044000
-- 035:440000444444444404444440044ff44004444440044444400044440000044000
-- 036:9900009909999990099999900999999009f99f90999999990999999009999990
-- 037:99000099099999900999999009f99f9009f99f90999999990999999009999990
-- </SPRITES>

-- <MAP>
-- 002:000212121212121212122200021212122200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:000313131313131313132300031313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:000313131313131313132300041414142400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:000414141414141414142400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:fffffffffffffffffff0000000000000
-- 001:0123456789abcdeffedcba9876543210
-- 002:13445666655554444333333222222223
-- 004:79bcdeefffeedcb97532110001123576
-- 009:00000000000000000000006600000000
-- </WAVES>

-- <SFX>
-- 000:14c0249e346e442f641074639495b445c400d400e400e400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400305000000000
-- 001:2100310e311a4128514a616f818791c7a1f7b1f0c1f0e100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100316000000000
-- 002:010d010e013f11301161118221a321c531d741d061008100a100c100d100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100c12000000000
-- 003:0100117021003190410051b0710091d0a100c1f0d100e100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100470000000000
-- 004:01f011c0112011a02130319031404170515051a061607170814091309110a120b100b150b100c100c180c130c120d130d120d110e110f100f100f100240000000000
-- 005:14e01430343064307440848094e0b450c4d0d430e440e400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400300000000000
-- 032:100010001000200030003000500070008000a000c000e000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000300000000000
-- 033:220022002200220022002200220022002200220022002200220022002200220022002200220022002200220022002200220022002200220022002200670000000000
-- 034:e100810061005100410041005100610081009100b100c100e100e100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100300000000000
-- 035:61005100510041004100410051006100710071008100a100b100c100d100e100f100f100f100f100f100f100f100f100f100f100f100f100f100f100400000000000
-- 036:f100a10071006100510041003100210021002100310041005100610071009100a100c100d100e100f100f100f100f100f100f100f100f100f100f100300000000000
-- 037:d310b3209322833d735173526351536153615371536153516340633073307320733f832f8333835f936fa3bfb34fc362d371d371e380e38fe34ff30f480000000000
-- 038:1400145024002480240024b03400448054006430740084009400a400b400d400e400e400f400f400f400f400f400f400f400f400f400f400f400f400000000000000
-- 039:143014001460240034a0440054c0640074f084009400a400c400d400d400e400e400f400f400f400f400f400f400f400f400f400f400f400f400f400000000000000
-- 048:d100a10071005100310021001100110011002100410061009100c100d100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100510000000000
-- 049:d1008120410031306180f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100560000000000
-- 050:d1008120410031306180f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f1005e0000000000
-- </SFX>

-- <PATTERNS>
-- 000:400846000840000840000000400846000000000000000000601f46000840000000000000600846600846000000000000800846000000000000000000800846000000000000000000602f46000840000000000000600846600846000000000000400846000000000000000000400846000000000000000000601f46000000000000000000600846600846000000000000800846000000000000000000800846000000000000000000602f46000000000000000000600846600846000000000000
-- 001:000830000000000830602c32400832000000000000000000000830000000a00832600832400832000000000000000000401f32000000000000000000402f32000000a00832600832400832000000000000000000000830000830000000000000000830000000000000600832400832000000000830000830000830000000a00832600832400832000000000000000000401f32000000000830000830402f32000000a00832600832400832000000000000000830000830000000000000000000
-- 002:43ae1a000820b0081a00081003be10000000000000000000000000000000000000000000000000000000000000000000400826000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b3ae1a00082043be1a000000000810000000000000000000000000000000000000000000000000000000000000000000400826000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:400846000840000840000000400846000000000000000000601f46000840000000000000600846600846000000000000800846000000000000000000800846000000000000000000602f46000840000000000000600846600846000000000000400846000000000000000000400846000000000000000000601f46000000000000000000600846600846000000000000800846000000000000000000800846000000000000000000602f46000000000000000000600846600846000000000000
-- 009:b00804000840b00804000000e00804000000f00804000000400806000000f00804000000e00804000000d00804000000b00804000000b00804000000e00804000000f00804000000400806000000f00804000000e00804000000d00804000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 010:b00802000840b00802000000e00802000000f00802000000400804000000f00802000000e00802000000d00802000000b00802000000b00802000000e00802000000f00802000000400804000000f00802000000e00802000000d00802000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 011:e00808000840f00808000000e00808000000f00808000000d00808000000b00808000000b00808000000d00808000000e00808000000f00808000000d00808000000b00808000000b00808000000000800000000000800000000000800000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 012:e00808000840f00808000000e00808000000f00808000000d00808000000b00808000000b00808000000d00808000000000800000000000800000000000800000000000800000000000800000000000800000000000800000000000800000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 013:b00802000000b01f02000800000800000000b00802000800400804000000401f04000800000800000000400804000800b00802000800b01f02000800000800000000b00802000800400804000000401f04000000000800000000400804000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:400802000000401f02000800000800000000400802000800900802000000901f02000800000800000000900802000800400802000800401f02000800000800000000400802000800900802000000901f02000000000800000000900802000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:700808000840800808000000700808000000800808000000600808000000400808000000400808000000d00806000000700808000000800808000000600808000000400808000000400808000000000800000000000800000000000800000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 016:700808000840800808000000700808000000800808000000600808000000400808000000400808000000d00806000000a00806000000d00806000000f00806000000600808000000404c08000000000800000000f04c06000000000800000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 017:700808000840800808000000600808000000400808000000400808000000000800000000000800000000000800000000700808000000800808000000600808000000400808000000400808000000000800000000000800000000000800000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 018:700808000840800808000000700808000000800808000000600808000000400808000000400808000000d00806000000400808000000000800000000604c08000000000800000000409c08000000000800000000000800000000000800000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 019:844e18000000000000000000000000000000000000000000600818000000000000000000b00818000000000000000000400818000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 020:d44e18000000000000000000000000000000000000000000b0081800000000000000000040081a000000000000000000900818000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 021:d44e18000000000000000000000000000000000000000000b00818000000000000000000f0081800000000000000000040081a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 022:400804000840000800000000000000000000400804000000000000000000000800000000f00802000000000800000000d00802000000000000000000000000000000d00802000000000000000000000000000800d00802000000000000000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 023:900804000840000800000000000000000000900804000000000000000000000800000000800802000000000800000000600802000000000000000000000000000000600802000000000000000000000000000800600802000000000000000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 024:d99e1a000000000000000000000000000000000000000000b0081a000000000000000000f0081a00000000000000000040081c000000000000000000000800000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 025:b00804000000b01f04000800000800000000b00804000800400806000000401f06000800000800000000400806000800b00804000800b01f04000800000800000000b00804000800400806000000401f06000000000800000000400806000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </PATTERNS>

-- <TRACKS>
-- 000:1000001800001803001803001000001800001803001803001000000000000000000000000000000000000000000000004c0000
-- 001:a00000ac2000ac2c00ac2d00ec2c00ec2d00e00010e001100c2210f003104d50005160004d5000616910a10e00a100006f0200
-- </TRACKS>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>
