-- title:   game title
-- author:  game developer, email, etc.
-- desc:    short description
-- site:    website link
-- license: MIT License (change this to your license of choice)
-- version: 0.1
-- script:  lua

math.randomseed(tstamp())

Console = {
	open = true,
	lines = {},
	max = 120,
	scroll = 0,
	actions = {},
	action_keys = { 4, 5, 6, 7 },
	action_labels = {},
}

function Console.toggle()
	Console.open = not Console.open
end

function Console.log(msg)
	local t = tstamp()

	local hours = math.floor(t / 3600) % 24
	local minutes = math.floor(t / 60) % 60
	local seconds = math.floor(t) % 60
	local s = string.format("[%02d:%02d:%02d] %s", hours, minutes, seconds, tostring(msg))

	table.insert(Console.lines, s)
	if #Console.lines > Console.max then
		table.remove(Console.lines, 1)
	end
end

function Console.update()
	if btnp(7) then
		Console.toggle()
	end
	if not Console.open then
		return
	end
	if btnp(2) then
		Console.scroll = math.min(Console.scroll + 1, math.max(0, #Console.lines - 1))
	end
	if btnp(3) then
		Console.scroll = math.max(Console.scroll - 1, 0)
	end
end

function Console.draw()
	if not Console.open then
		return
	end
	local w, h = 140, 120
	local x, y = 100, 0
	rect(x, y, w, h, 0)
	rectb(x, y, w, h, 13)
	local visible = 9
	local start = math.max(1, #Console.lines - visible - Console.scroll + 1)
	local idx = 0
	for i = start, math.min(#Console.lines, start + visible - 1) do
		print(Console.lines[i], x + 4, y + 4 + idx * 8, 12, false, 1, true)
		idx = idx + 1
	end
end

-- Global variables --

local SFX = {
	DROP = 0,
	MOVE = 1,
	ROTATE = 2,
	CLEAR = 3,
	OVERFLOW = 4,
	INVALID = 5,
}

local TRACK = {
	FLORA = 0,
	FEVER = 1,
}

-- Global variables end --

-- Audio manager --

local Audio = {
	bgm = nil,
	reserved = {
		sfx = 3,
		bgm = { 0, 1, 2 },
	},
}

function Audio.playBGM(track, loop)
	if Audio.bgm == track then
		return
	end
	music(track, 0, 0, loop ~= false)
	Audio.bgm = track
end

function Audio.stopBGM()
	music(-1)
	Audio.bgm = nil
end

function Audio.play(id, vol, spd)
	sfx(id, nil, -1, Audio.reserved.sfx, vol or 15, spd or 0, false)
end

-- Audio manager end --

-- Pill manager --

local RUNES = {
	{ name = "RED", W = 490, E = 491, N = 492, S = 508 },
	{ name = "YELLOw", W = 506, E = 507, N = 493, S = 509 },
	{ name = "BLUE", W = 488, E = 489, N = 494, S = 510 },
}

local Runes = {}

function Runes.gen_binding_rune()
	local rune1 = RUNES[math.random(1, #RUNES)]
	local rune2 = RUNES[math.random(1, #RUNES)]
	Console.log(string.format("l: %s, r: %s", rune1.name, rune2.name))
	return { rune1 = rune1, rune2 = rune2 }
end

-- Pill manager end --

-- Keymap start --

local KEYMAP_P1 = {
	LEFT = 2,
	RIGHT = 3,
	UP = 0,
	DOWN = 1,
	A = 5,
	B = 4,
}

-- Keymap end --

-- Grid manager --

local BORDER = {
	TOPLEFT = 32,
	TOP = 33,
	TOPRIGHT = 34,
	LEFT = 48,
	CENTER = 49,
	RIGHT = 50,
	BOTTOMLEFT = 64,
	BOTTOM = 65,
	BOTTOMRIGHT = 66,
}

local Grid = {
	cell_size = 8,
	h = 16,
	w = 10,
	static_bindings = {},
	active_binding = nil,
	stones = {},
	pill_on_scene = false,
	interval = 60,
}

local STONES = {
	{ name = "R", spr = 256 },
	{ name = "S", spr = 272 },
	{ name = "E", spr = 288 },
}

function Grid.effective_interval()
	if btn(KEYMAP_P1.DOWN) then
		return Grid.interval / 10
	end
	return Grid.interval
end

function Grid.generate_stones(level)
	local presets = {
		[1] = { n = 3, safe = 0.55 },
		[2] = { n = 5, safe = 0.50 },
		[3] = { n = 8, safe = 0.45 },
		[4] = { n = 12, safe = 0.40 },
		[5] = { n = 17, safe = 0.35 },
		[6] = { n = 23, safe = 0.30 },
		[7] = { n = 30, safe = 0.25 },
		[8] = { n = 38, safe = 0.20 },
		[9] = { n = 47, safe = 0.15 },
		[10] = { n = 57, safe = 0.10 },
	}
	local preset = presets[level]
	if not preset then
		Console.log("level too high")
		return {}
	end

	local stones = {}

	local h_start = math.floor(preset.safe * Grid.h)
	local bag = {}

	for ly = h_start, Grid.h - 1, 1 do
		for lx = 0, Grid.w - 1, 1 do
			table.insert(bag, { x = lx, y = ly })
		end
	end

	-- generate red
	local rand_num = math.random(#bag)
	local rand_pos = bag[rand_num]
	table.remove(bag, rand_num)
	table.insert(stones, {
		name = "R",
		spr = 256,
		x = rand_pos.x,
		y = rand_pos.y,
	})

	-- generate yellow
	rand_num = math.random(#bag)
	rand_pos = bag[rand_num]
	table.remove(bag, rand_num)
	table.insert(stones, {
		name = "S",
		spr = 272,
		x = rand_pos.x,
		y = rand_pos.y,
	})

	-- generate blue
	rand_num = math.random(#bag)
	rand_pos = bag[rand_num]
	table.remove(bag, rand_num)
	table.insert(stones, {
		name = "E",
		spr = 288,
		x = rand_pos.x,
		y = rand_pos.y,
	})

	-- TODO: add more stones if level is higher than 1

	Grid.stones = stones
end

function Grid.draw_stones()
	for _, stone in ipairs(Grid.stones) do
		spr(stone.spr, stone.x * Grid.cell_size, stone.y * Grid.cell_size)
	end
end

function Grid.spawn_binding(binding)
	local spawnx = 0
	if Grid.w % 2 == 0 then
		spawnx = Grid.w / 2 - 1
	else
		spawnx = (Grid.w - 1) / 2
	end
	local spawny = 0

	Grid.active_binding = {
		rune1 = binding.rune1,
		rune2 = binding.rune2,
		x = spawnx,
		y = spawny,
		rotation = 0,
	}
end

function Grid.rotate_clockwise()
	if Grid.active_binding == nil then
		Console.log("error rotating binding - no active binding in game")
		return
	end

	local next_rotation = (Grid.active_binding.rotation + 1) % 4
	local x1, y1, x2, y2 = Grid.get_binding_xy(next_rotation)
	if Grid.available(x1, y1) and Grid.available(x2, y2) then
		Console.log("can rotate")
		Grid.active_binding.rotation = next_rotation
	else
		Console.log("cannot rotate")
	end
end

function Grid.rotate_counterclockwise()
	if Grid.active_binding == nil then
		Console.log("error rotating binding - no active binding in game")
		return
	end

	local next_rotation = (Grid.active_binding.rotation + 3) % 4
	local x1, y1, x2, y2 = Grid.get_binding_xy(next_rotation)
	if Grid.available(x1, y1) and Grid.available(x2, y2) then
		Console.log("can rotate")
		Grid.active_binding.rotation = next_rotation
	else
		Console.log("cannot rotate")
	end
end

function Grid.move_left()
	if Grid.active_binding == nil then
		Console.log("error moving binding left - no active binding in game")
		return
	end

	local x1, y1, x2, y2 = Grid.get_active_binding_xy()
	if Grid.available(x1 - 1, y1) and Grid.available(x2 - 1, y2) then
		Console.log("can move")
		Grid.active_binding.x = Grid.active_binding.x - 1
	else
		Console.log("cannot move")
	end
end

function Grid.move_right()
	if Grid.active_binding == nil then
		Console.log("error moving binding right - no active binding in game")
		return
	end

	local x1, y1, x2, y2 = Grid.get_active_binding_xy()
	if Grid.available(x1 + 1, y1) and Grid.available(x2 + 1, y2) then
		Console.log("can move")
		Grid.active_binding.x = Grid.active_binding.x + 1
	else
		Console.log("cannot move")
	end
end

function Grid.available(x, y)
	if x < 0 or x > Grid.w - 1 then
		return false
	end

	for _, stone in ipairs(Grid.stones) do
		if stone.x == x and stone.y == y then
			return false
		end
	end
	return true
end

function Grid.get_active_binding_xy()
	local active = Grid.active_binding
	if active == nil then
		Console.log("error: active binding not found")
		return
	end

	return Grid.get_binding_xy(Grid.active_binding.rotation)
end

function Grid.get_binding_xy(rotation)
	local active = Grid.active_binding
	if active == nil then
		Console.log("error: active binding not found")
		return
	end

	if rotation == 0 then
		return active.x, active.y, active.x + 1, active.y
	elseif rotation == 1 then
		return active.x, active.y - 1, active.x, active.y
	elseif rotation == 2 then
		return active.x + 1, active.y, active.x, active.y
	elseif rotation == 3 then
		return active.x, active.y, active.x, active.y - 1
	end

	return nil, nil, nil, nil
end

function Grid.get_active_binding_spr()
	local active = Grid.active_binding
	if active == nil then
		Console.log("error: no active binding found")
		return
	end

	local spr1 = nil
	local spr2 = nil
	if active.rotation == 0 then
		spr1 = active.rune1.W
		spr2 = active.rune2.E
	elseif active.rotation == 1 then
		spr1 = active.rune1.N
		spr2 = active.rune2.S
	elseif active.rotation == 2 then
		spr1 = active.rune1.E
		spr2 = active.rune2.W
	elseif active.rotation == 3 then
		spr1 = active.rune1.S
		spr2 = active.rune2.N
	else
		Console.log("error: unknown rotation")
		return
	end

	return spr1, spr2
end

function Grid.draw_static_bindings()
	for _, pill in ipairs(Grid.static_bindings) do
		if pill == nil then
			Console.log("static pill is nil")
			return
		end

		local cx = pill.x * Grid.cell_size
		local cy = pill.y * Grid.cell_size

		-- find appropriate sprite to draw
	end
end

function Grid.draw_active_binding()
	local active = Grid.active_binding
	if active == nil then
		Console.log("cannot draw pill - no pill in game")
		return
	end

	local x1, y1, x2, y2 = Grid.get_active_binding_xy()
	local spr1, spr2 = Grid.get_active_binding_spr()

	spr(spr1, x1 * Grid.cell_size, y1 * Grid.cell_size)
	spr(spr2, x2 * Grid.cell_size, y2 * Grid.cell_size)
end

function Grid.grav()
	local active = Grid.active_binding
	if active == nil then
		Console.log("cannot draw pill - no pill in game")
		return
	end

	local x1, y1, x2, y2 = Grid.get_active_binding_xy()

	if Grid.available(x1, y1 + 1) and Grid.available(x2, y2 + 1) then
		active.y = active.y + 1
	else
		Audio.play(SFX.INVALID)
	end
end

function Grid.draw_border()
	for y = 0, Grid.h - 1 do
		local cy = y * Grid.cell_size
		for x = 0, Grid.w - 1 do
			local cx = x * Grid.cell_size

			if y == 0 then
				if x == 0 then
					spr(BORDER.TOPLEFT, cx, cy)
				elseif x == Grid.w - 1 then
					spr(BORDER.TOPRIGHT, cx, cy)
				else
					spr(BORDER.TOP, cx, cy)
				end
			elseif y == Grid.h - 1 then
				if x == 0 then
					spr(BORDER.BOTTOMLEFT, cx, cy)
				elseif x == Grid.w - 1 then
					spr(BORDER.BOTTOMRIGHT, cx, cy)
				else
					spr(BORDER.BOTTOM, cx, cy)
				end
			else
				if x == 0 then
					spr(BORDER.LEFT, cx, cy)
				elseif x == Grid.w - 1 then
					spr(BORDER.RIGHT, cx, cy)
				else
					spr(BORDER.CENTER, cx, cy)
				end
			end
		end
	end
end

-- Grid manager end --

-- Game manager --

local SCENES = {
	TITLE = 0,
	GAME = 1,
}

local Game = {
	scene = SCENES.GAME,
	pill_on_scene = false,
}

function Grid.eval()
	if Grid.pill_on_scene == false then
		local pill = Runes.gen_binding_rune()
		Grid.spawn_binding(pill)
		Grid.pill_on_scene = true
	else
		Grid.grav()
	end
end

-- Game manager end --

t = 0
x = 96
y = 24
inter = 60

Grid.generate_stones(1)

function TIC()
	Audio.playBGM(TRACK.FLORA)

	Console.update()

	if btn(0) then
		y = y - 1
	end
	if btn(1) then
		y = y + 1
	end
	if btn(2) then
		x = x - 1
	end
	if btn(3) then
		x = x + 1
	end

	if btnp(KEYMAP_P1.A) then
		Grid.rotate_clockwise()
	end

	if btnp(KEYMAP_P1.B) then
		Grid.rotate_counterclockwise()
	end

	if btnp(KEYMAP_P1.LEFT) then
		Grid.move_left()
	end

	if btnp(KEYMAP_P1.RIGHT) then
		Grid.move_right()
	end

	if t % Grid.effective_interval() == 0 then
		Grid.eval()
	end

	cls(13)
	-- Grid.draw_static_bindings()()
	Grid.draw_border()
	Grid.draw_stones()
	Grid.draw_active_binding()
	Console.draw()
	t = t + 1
end

-- <TILES>
-- 001:eccccccccc888888caaaaaaaca888888cacccccccacc0ccccacc0ccccacc0ccc
-- 002:ccccceee8888cceeaaaa0cee888a0ceeccca0ccc0cca0c0c0cca0c0c0cca0c0c
-- 003:eccccccccc888888caaaaaaaca888888cacccccccacccccccacc0ccccacc0ccc
-- 004:ccccceee8888cceeaaaa0cee888a0ceeccca0cccccca0c0c0cca0c0c0cca0c0c
-- 017:cacccccccaaaaaaacaaacaaacaaaaccccaaaaaaac8888888cc000cccecccccec
-- 018:ccca00ccaaaa0ccecaaa0ceeaaaa0ceeaaaa0cee8888ccee000cceeecccceeee
-- 019:cacccccccaaaaaaacaaacaaacaaaaccccaaaaaaac8888888cc000cccecccccec
-- 020:ccca00ccaaaa0ccecaaa0ceeaaaa0ceeaaaa0cee8888ccee000cceeecccceeee
-- 032:0000000000bbbbbb0bbbbbbb0bbb00000bb0f00f0bb000000bb000000bb0f00f
-- 033:00000000bbbbbbbbbbbbbbbb0000000000f00f00000000000000000000f00f00
-- 034:00000000bbbbbb00bbbbbbb00000bbb0f00f0bb000000bb000000bb0f00f0bb0
-- 048:0bb000000bb000000bb0f00f0bb000000bb000000bb0f00f0bb000000bb00000
-- 049:000000000000000000f00f00000000000000000000f00f000000000000000000
-- 050:00000bb000000bb0f00f0bb000000bb000000bb0f00f0bb000000bb000000bb0
-- 064:0bb0f00f0bb000000bb000000bb0f00f0bbb00000bbbbbbb00bbbbbb00000000
-- 065:00f00f00000000000000000000f00f0000000000bbbbbbbbbbbbbbbb00000000
-- 066:f00f0bb000000bb000000bb0f00f0bb00000bbb0bbbbbbb0bbbbbb0000000000
-- </TILES>

-- <SPRITES>
-- 000:00ccccc00cc332cccc23232cc223232cc223322cc123232ccc1311cc0cccccc0
-- 001:00ccccc00cc33dcccc23232cc223232cc223322cc123232ccc1311cc0cccccc0
-- 002:00ccccc00cc33dcccce3e3dcc22323ecc223322cc123232ccc1311cc0cccccc0
-- 003:00ccccc00cc33dcccce3e3dccee3e3ecc22332ecc122232ccc1211cc0cccccc0
-- 004:00ccccc00cc33dcccce3e3dccee2e2ecc2e22eecc122e2eccc1211cc0cccccc0
-- 005:00ccccc00cc33dcccce2e2dccee2e2ecc2e22eecc122e2eccc1211cc0cccccc0
-- 006:00ccccc00cc22dcccce2e2dccee2e2eccee22eeccfe2e2ecccf2ffcc0cccccc0
-- 016:0ccccc00cc665cc0c66566ccc655556cc766566cc775666ccc5777cc0cccccc0
-- 017:0ccccc00cced5cc0c665eeccc655556cc766566cc775666ccc5777cc0cccccc0
-- 018:0ccccc00cced5cc0cee5eeccc65555ecc766566cc775666ccc5777cc0cccccc0
-- 019:0ccccc00cced5cc0cee5eeccce5555ecc7ee5eecc775666ccc6777cc0cccccc0
-- 020:0ccccc00cced5cc0cee5eeccce5555ecceee6eecc7e6eeeccc6777cc0cccccc0
-- 021:0ccccc00cced5cc0cee5eeccce6666ecceee6eeccfe6eeeccc6fffcc0cccccc0
-- 022:0ccccc00cced6cc0cee6eeccce6666ecceee6eeccff6eeeccc6fffcc0cccccc0
-- 032:0ccccc00ccabacc0caabbacccaababaccbabaabcc9bbaaaccc9b99cc0cccccc0
-- 033:0ccccc00ccabdcc0caabbecccaababaccbabaabcc9bbaaaccc9b99cc0cccccc0
-- 034:0ccccc00ccebdcc0caabbecccaabebeccbabaabcc9bbaaaccc9b99cc0cccccc0
-- 035:0ccccc00ccebdcc0ceebbdcccaabebeccbabeebcc9bbaaeccc9b99cc0cccccc0
-- 036:0ccccc00ccebdcc0ceebbeccceebebeccaeaeebcc9aaeeeccc9a99cc0cccccc0
-- 037:0ccccc00ccebdcc0ceeabeccceeaebeccaeaeeaccfaaeeecccfaffcc0cccccc0
-- 038:0ccccc00cceadcc0ceeaaeccceeaeaeccaeaeeaccfaaeeecccfaffcc0cccccc0
-- 112:0ccccccccc222222c2222333c2222222c2122222c2212222cc2222220ccccccc
-- 113:ccccccc0666666cc5666566c6666656c6666666c6666666c666666ccccccccc0
-- 114:0cccccc0cc2222ccc222322cc222232cc222222cc222232cc222232cc222232c
-- 115:0cccccc0cc6666ccc666566cc666656cc666666cc666656cc666656cc666656c
-- 116:0ccccccccc666666c6666555c6666666c6766666c6676666cc6666660ccccccc
-- 117:ccccccc0aaaaaaccbaaabaacaaaaabacaaaaaaacaaaaaaacaaaaaaccccccccc0
-- 118:0cccccc0cc6666ccc666566cc666656cc666666cc666656cc666656cc666656c
-- 119:0cccccc0ccaaaacccaaabaaccaaaabaccaaaaaaccaaaabaccaaaabaccaaaabac
-- 120:0cccccccccaaaaaacaaaabbbcaaaaaaaca9aaaaacaa9aaaaccaaaaaa0ccccccc
-- 121:ccccccc0222222cc3222322c2222232c2222222c2222222c222222ccccccccc0
-- 122:0cccccc0ccaaaacccaaabaaccaaaabaccaaaaaaccaaaabaccaaaabaccaaaabac
-- 123:0cccccc0cc2222ccc222322cc222232cc222222cc222232cc222232cc222232c
-- 128:0ccccccccc666666c6666555c6666666c6766666c6676666cc6666660ccccccc
-- 129:ccccccc0222222cc3222322c2222232c2222222c2222222c222222ccccccccc0
-- 130:c666656cc666666cc666666cc666666cc676666cc667666ccc6666cc0cccccc0
-- 131:c222232cc222222cc222222cc222222cc212222cc221222ccc2222cc0cccccc0
-- 132:0cccccccccaaaaaacaaaabbbcaaaaaaaca9aaaaacaa9aaaaccaaaaaa0ccccccc
-- 133:ccccccc0666666cc5666566c6666656c6666666c6666666c666666ccccccccc0
-- 134:caaaabaccaaaaaaccaaaaaaccaaaaaacca9aaaaccaa9aaacccaaaacc0cccccc0
-- 135:c666656cc666666cc666666cc666666cc676666cc667666ccc6666cc0cccccc0
-- 136:0ccccccccc222222c2222333c2222222c2122222c2212222cc2222220ccccccc
-- 137:ccccccc0aaaaaaccbaaabaacaaaaabacaaaaaaacaaaaaaacaaaaaaccccccccc0
-- 138:c222232cc222222cc222222cc222222cc212222cc221222ccc2222cc0cccccc0
-- 139:caaaabaccaaaaaaccaaaaaaccaaaaaacca9aaaaccaa9aaacccaaaacc0cccccc0
-- 232:0cccccccccaaaaaacaaaabbbcaaaaaaaca9aaaaacaa9aaaaccaaaaaa0ccccccc
-- 233:ccccccc0aaaaaaccbaaabaacaaaaabacaaaaaaacaaaaaaacaaaaaaccccccccc0
-- 234:0ccccccccc222222c2222333c2222222c2122222c2212222cc2222220ccccccc
-- 235:ccccccc0222222cc3222322c2222232c2222222c2222222c222222ccccccccc0
-- 236:0cccccc0cc2222ccc222322cc222232cc222222cc222232cc222232cc222232c
-- 237:0cccccc0cc6666ccc666566cc666656cc666666cc666656cc666656cc666656c
-- 238:0cccccc0ccaaaacccaaabaaccaaaabaccaaaaaaccaaaabaccaaaabaccaaaabac
-- 239:0cccccc0cceeeeccceeedeecceeeedecceeeeeecceeeedecceeeedecceeeedec
-- 248:0ccccccccceeeeeeceeeedddceeeeeeecefeeeeeceefeeeecceeeeee0ccccccc
-- 249:ccccccc0eeeeeeccdeeedeeceeeeedeceeeeeeeceeeeeeeceeeeeeccccccccc0
-- 250:0ccccccccc666666c6666555c6666666c6766666c6676666cc6666660ccccccc
-- 251:ccccccc0666666cc5666566c6666656c6666666c6666666c666666ccccccccc0
-- 252:c222232cc222222cc222222cc222222cc212222cc221222ccc2222cc0cccccc0
-- 253:c666656cc666666cc666666cc666666cc676666cc667666ccc6666cc0cccccc0
-- 254:caaaabaccaaaaaaccaaaaaaccaaaaaacca9aaaaccaa9aaacccaaaacc0cccccc0
-- 255:ceeeedecceeeeeecceeeeeecceeeeeeccefeeeecceefeeeccceeeecc0cccccc0
-- </SPRITES>

-- <MAP>
-- 002:000212121212121212122200021212122200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:000313131313131313132300031313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:000313131313131313132300041414142400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:000313131313131313132300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:000414141414141414142400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:fffffffffffffffffff0000000000000
-- 001:0123456789abcdeffedcba9876543210
-- 002:13445666655554444333333222222223
-- 004:79bcdeefffeedcb97532110001123576
-- 009:00000000000000000000006600000000
-- </WAVES>

-- <SFX>
-- 000:14c0249e346e442f641074639495b445c400d400e400e400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400305000000000
-- 001:2100310e311a4128514a616f818791c7a1f7b1f0c1f0e100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100316000000000
-- 002:010d010e013f11301161118221a321c531d741d061008100a100c100d100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100c12000000000
-- 003:0100117021003190410051b0710091d0a100c1f0d100e100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100470000000000
-- 004:01f011c0112011a02130319031404170515051a061607170814091309110a120b100b150b100c100c180c130c120d130d120d110e110f100f100f100240000000000
-- 005:14e01430343064307440848094e0b450c4d0d430e440e400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400f400300000000000
-- 032:100010001000200030003000500070008000a000c000e000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000300000000000
-- 033:220022002200220022002200220022002200220022002200220022002200220022002200220022002200220022002200220022002200220022002200670000000000
-- 034:e100810061005100410041005100610081009100b100c100e100e100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100300000000000
-- 035:61005100510041004100410051006100710071008100a100b100c100d100e100f100f100f100f100f100f100f100f100f100f100f100f100f100f100400000000000
-- 036:f100a10071006100510041003100210021002100310041005100610071009100a100c100d100e100f100f100f100f100f100f100f100f100f100f100300000000000
-- 037:d310b3209322833d735173526351536153615371536153516340633073307320733f832f8333835f936fa3bfb34fc362d371d371e380e38fe34ff30f480000000000
-- 038:1400145024002480240024b03400448054006430740084009400a400b400d400e400e400f400f400f400f400f400f400f400f400f400f400f400f400000000000000
-- 039:143014001460240034a0440054c0640074f084009400a400c400d400d400e400e400f400f400f400f400f400f400f400f400f400f400f400f400f400000000000000
-- 048:d100a10071005100310021001100110011002100410061009100c100d100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100510000000000
-- 049:d1008120410031306180f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100560000000000
-- 050:d1008120410031306180f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f100f1005e0000000000
-- </SFX>

-- <PATTERNS>
-- 000:400846000840000840000000400846000000000000000000601f46000840000000000000600846600846000000000000800846000000000000000000800846000000000000000000602f46000840000000000000600846600846000000000000400846000000000000000000400846000000000000000000601f46000000000000000000600846600846000000000000800846000000000000000000800846000000000000000000602f46000000000000000000600846600846000000000000
-- 001:000830000000000830602c32400832000000000000000000000830000000a00832600832400832000000000000000000401f32000000000000000000402f32000000a00832600832400832000000000000000000000830000830000000000000000830000000000000600832400832000000000830000830000830000000a00832600832400832000000000000000000401f32000000000830000830402f32000000a00832600832400832000000000000000830000830000000000000000000
-- 002:43ae1a000820b0081a00081003be10000000000000000000000000000000000000000000000000000000000000000000400826000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b3ae1a00082043be1a000000000810000000000000000000000000000000000000000000000000000000000000000000400826000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:400846000840000840000000400846000000000000000000601f46000840000000000000600846600846000000000000800846000000000000000000800846000000000000000000602f46000840000000000000600846600846000000000000400846000000000000000000400846000000000000000000601f46000000000000000000600846600846000000000000800846000000000000000000800846000000000000000000602f46000000000000000000600846600846000000000000
-- 009:b00804000840b00804000000e00804000000f00804000000400806000000f00804000000e00804000000d00804000000b00804000000b00804000000e00804000000f00804000000400806000000f00804000000e00804000000d00804000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 010:b00802000840b00802000000e00802000000f00802000000400804000000f00802000000e00802000000d00802000000b00802000000b00802000000e00802000000f00802000000400804000000f00802000000e00802000000d00802000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 011:e00808000840f00808000000e00808000000f00808000000d00808000000b00808000000b00808000000d00808000000e00808000000f00808000000d00808000000b00808000000b00808000000000800000000000800000000000800000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 012:e00808000840f00808000000e00808000000f00808000000d00808000000b00808000000b00808000000d00808000000000800000000000800000000000800000000000800000000000800000000000800000000000800000000000800000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 013:b00802000000b01f02000800000800000000b00802000800400804000000401f04000800000800000000400804000800b00802000800b01f02000800000800000000b00802000800400804000000401f04000000000800000000400804000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:400802000000401f02000800000800000000400802000800900802000000901f02000800000800000000900802000800400802000800401f02000800000800000000400802000800900802000000901f02000000000800000000900802000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:700808000840800808000000700808000000800808000000600808000000400808000000400808000000d00806000000700808000000800808000000600808000000400808000000400808000000000800000000000800000000000800000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 016:700808000840800808000000700808000000800808000000600808000000400808000000400808000000d00806000000a00806000000d00806000000f00806000000600808000000404c08000000000800000000f04c06000000000800000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 017:700808000840800808000000600808000000400808000000400808000000000800000000000800000000000800000000700808000000800808000000600808000000400808000000400808000000000800000000000800000000000800000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 018:700808000840800808000000700808000000800808000000600808000000400808000000400808000000d00806000000400808000000000800000000604c08000000000800000000409c08000000000800000000000800000000000800000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 019:844e18000000000000000000000000000000000000000000600818000000000000000000b00818000000000000000000400818000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 020:d44e18000000000000000000000000000000000000000000b0081800000000000000000040081a000000000000000000900818000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 021:d44e18000000000000000000000000000000000000000000b00818000000000000000000f0081800000000000000000040081a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 022:400804000840000800000000000000000000400804000000000000000000000800000000f00802000000000800000000d00802000000000000000000000000000000d00802000000000000000000000000000800d00802000000000000000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 023:900804000840000800000000000000000000900804000000000000000000000800000000800802000000000800000000600802000000000000000000000000000000600802000000000000000000000000000800600802000000000000000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000b00846000000b00846000000e00846000000f00846000000400848000000f00846000000e00846000000d00846000000
-- 024:d99e1a000000000000000000000000000000000000000000b0081a000000000000000000f0081a00000000000000000040081c000000000000000000000800000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 025:b00804000000b01f04000800000800000000b00804000800400806000000401f06000800000800000000400806000800b00804000800b01f04000800000800000000b00804000800400806000000401f06000000000800000000400806000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </PATTERNS>

-- <TRACKS>
-- 000:1000001800001803001803001000001800001803001803001000000000000000000000000000000000000000000000004c0000
-- 001:a00000ac2000ac2c00ac2d00ec2c00ec2d00e00010e001100c2210f003104d50005160004d5000616910a10e00a100006f0200
-- </TRACKS>

-- <PALETTE>
-- 000:7d819d5d275dc23e53ef7d57fafafaffffe6ffd691a5757929366f3b5dc92091ff73eff71a1c2c94b0c2566c86333c57
-- </PALETTE>
